<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no">
<title>Lager App</title>

<style>
body {
    margin: 0;
    background: #000;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

#topbar {
    position: fixed;
    top: 0; left: 0; right: 0;
    padding: 15px;
    background: #000;
    z-index: 1000;
    border-bottom: 2px solid #333;
}

#counterWrapper {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
}

.counter-box {
    padding: 10px;
    border: 1px solid #444;
    border-radius: 10px;
    background: #000;
}

.counter-title { font-size: 11px; color: #bbb; }
.counter-value { font-size: 18px; font-weight: bold; }

#searchRow { margin-top: 10px; }

#search {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    background: #111;
    border: 1px solid #444;
    color: white;
}

#buttonRow {
    margin-top: 10px;
    display: flex;
    gap: 8px;
}

#buttonRow button {
    flex: 1;
    padding: 10px;
    font-size: 11px;
    color: #bbb;
    border-radius: 10px;
    background: #000;
    border: 1px solid #444;
    font-weight: bold;
}

#tableContainer {
    position: absolute;
    left: 0;
    right: 0;
    overflow-y: auto;
    overflow-x: hidden;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th {
    background: #111;
    position: sticky;
    top: 0;
    padding: 6px;
    color: #bbb;
    font-size: 10px;
}

td {
    padding: 5px;
    font-size: 11px;
    border-bottom: 1px solid #222;
}

.marked { background: #222; }

#popup {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #111;
    padding: 18px;
    border: 2px solid #444;
    border-radius: 12px;
    width: 90%;
    max-width: 380px;
    display: none;
    z-index: 9999;
}

.popup-row { margin-bottom: 10px; }

.popup-row input, .popup-row textarea {
    width: 100%;
    padding: 9px;
    border-radius: 8px;
    border: 1px solid #444;
    background: #1a1a1a;
    color: white;
}

#popup button {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    background: #000;
    border: 1px solid #444;
    color: white;
    font-weight: bold;
}
</style>
</head>

<body>

<div id="topbar">
    <div id="counterWrapper">
        <div class="counter-box"><div class="counter-title">Artikel im Bestand</div><div class="counter-value" id="countArtikel">0</div></div>
        <div class="counter-box"><div class="counter-title">Gegenstände insgesamt</div><div class="counter-value" id="countMenge">0</div></div>
        <div class="counter-box"><div class="counter-title">Warenwert aktuell (€)</div><div class="counter-value" id="countWert">0</div></div>
        <div class="counter-box"><div class="counter-title">Warenwert gesamt (€)</div><div class="counter-value" id="countWertTotal">0</div></div>
    </div>

    <div id="searchRow">
        <input id="search" placeholder="Suchen …" oninput="searchTable()">
    </div>

    <div id="buttonRow">
        <button onclick="openPopup()">Artikel anlegen</button>
        <button onclick="exportData()">Sichern</button>
        <button onclick="importData()">Laden</button>
        <button onclick="generatePDF()">PDF</button>
    </div>
</div>

<div id="tableContainer">
<table id="artikelTable">
<thead>
<tr>
    <th>*</th><th>Nr</th><th>Name</th><th>Menge</th><th>Größe</th>
    <th>Preis</th><th>Ort</th><th>Datum</th><th>Bild</th><th>Notiz</th><th>✏️</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<div id="popup">
    <div class="popup-row"><input id="p_artnr" placeholder="Artikelnummer"></div>
    <div class="popup-row"><input id="p_name" placeholder="Name"></div>
    <div class="popup-row"><input type="number" id="p_menge" value="1"></div>
    <div class="popup-row"><input id="p_groesse" placeholder="Größe"></div>
    <div class="popup-row"><input type="number" id="p_preis" step="0.01"></div>
    <div class="popup-row"><input id="p_ort" placeholder="Ort"></div>
    <div class="popup-row"><input type="date" id="p_datum"></div>
    <div class="popup-row"><textarea id="p_notiz" placeholder="Notiz"></textarea></div>
    <button onclick="saveArtikel()">Speichern</button>
</div>

<script>
let artikel = JSON.parse(localStorage.getItem("lagerData") || "[]");

let editIndex = -1;

function openPopup(){
  editIndex = -1;
  popup.style.display="block";
  p_artnr.value=p_name.value=p_groesse.value=p_ort.value=p_notiz.value="";
  p_menge.value=1; p_preis.value=0; p_datum.value="";
}

function editArtikel(i){
  editIndex = i;
  const a = artikel[i];
  p_artnr.value=a.artnr;
  p_name.value=a.name;
  p_menge.value=a.menge;
  p_groesse.value=a.groesse;
  p_preis.value=a.preis;
  p_ort.value=a.ort;
  p_datum.value=a.datum;
  p_notiz.value=a.notiz;
  popup.style.display="block";
}

function saveArtikel(){
  const data={
    artnr:p_artnr.value,
    name:p_name.value,
    menge:+p_menge.value,
    groesse:p_groesse.value,
    preis:+p_preis.value,
    ort:p_ort.value,
    datum:p_datum.value,
    bild:"",
    notiz:p_notiz.value,
    markiert:editIndex>-1?artikel[editIndex].markiert:false
  };

  if(editIndex>-1) artikel[editIndex]=data;
  else artikel.push(data);

  localStorage.setItem("lagerData", JSON.stringify(artikel));
  popup.style.display="none";
  renderTable();
  updateCounters();
}

function renderTable(){
  tableBody.innerHTML="";
  artikel.forEach((a,i)=>{
    const tr=document.createElement("tr");
    tr.className=a.markiert?"marked":"";
    tr.innerHTML=`
      <td onclick="toggleMark(${i})">${a.markiert?"⭐":"☆"}</td>
      <td>${a.artnr}</td><td>${a.name}</td><td>${a.menge}</td>
      <td>${a.groesse}</td><td>${a.preis.toFixed(2)}</td>
      <td>${a.ort}</td><td>${a.datum}</td><td>-</td><td>${a.notiz}</td>
      <td onclick="editArtikel(${i})">✏️</td>
    `;
    tableBody.appendChild(tr);
  });
}

function toggleMark(i){
  artikel[i].markiert=!artikel[i].markiert;
  localStorage.setItem("lagerData", JSON.stringify(artikel));
  renderTable();
}

function updateCounters(){
  countArtikel.innerText=artikel.length;
  let m=0,w=0;
  artikel.forEach(a=>{m+=a.menge; w+=a.menge*a.preis;});
  countMenge.innerText=m;
  countWert.innerText=w.toFixed(2);
  countWertTotal.innerText=w.toFixed(2);
}

function searchTable(){
  const q=search.value.toLowerCase();
  document.querySelectorAll("#artikelTable tbody tr").forEach(r=>{
    r.style.display=r.innerText.toLowerCase().includes(q)?"":"none";
  });
}

function exportData(){
  const b=new Blob([JSON.stringify(artikel)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="lager.json";
  a.click();
}

function importData(){
  const i=document.createElement("input");
  i.type="file"; i.accept="application/json";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{artikel=JSON.parse(r.result); localStorage.setItem("lagerData",JSON.stringify(artikel)); renderTable(); updateCounters();};
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

function generatePDF(){ alert("PDF kommt im nächsten Schritt."); }

/* ✅ WICHTIGER FIX: Tabelle korrekt unter Header positionieren */
function adjustTableTop(){
  const h = topbar.offsetHeight;
  tableContainer.style.top = h + "px";
  tableContainer.style.height = "calc(100vh - " + h + "px)";
}

window.onload=()=>{
  adjustTableTop();
  renderTable();
  updateCounters();
};
window.onresize=adjustTableTop;
</script>
</body>
</html>
