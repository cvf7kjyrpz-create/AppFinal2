<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no">
<title>Lager App</title>

<style>
body{margin:0;background:#000;color:white;font-family:Arial,sans-serif;overflow:hidden;}
#topbar{position:fixed;top:0;left:0;right:0;padding:15px;background:#000;z-index:5000;border-bottom:2px solid #333;}
#counterWrapper{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;}
.counter-box{padding:10px;border:1px solid #444;border-radius:10px;background:#000;}
.counter-title{font-size:11px;color:#bbb;}
.counter-value{font-size:18px;font-weight:bold;}
#searchRow{margin-top:10px;}
#search{width:100%;padding:10px;border-radius:8px;background:#111;border:1px solid #444;color:white;}
#buttonRow{margin-top:10px;display:flex;gap:8px;}
#buttonRow button{flex:1;padding:10px;font-size:11px;color:#bbb;border-radius:10px;background:#000;border:1px solid #444;font-weight:bold;}
#tableContainer{position:fixed;left:0;right:0;bottom:0;overflow-y:auto;overflow-x:auto;background:#000;}

table{width:100%;border-collapse:collapse;}
th{background:#111;position:sticky;top:0;z-index:200;padding:6px;color:#bbb;font-size:10px;}
td{padding:5px;font-size:11px;border-bottom:1px solid #222;}
.marked{background:#222;}
.iconCell span{cursor:pointer;margin-right:8px;}
.iconCell span.delete{margin-left:18px;}
input.miniQty{width:42px;background:#111;color:white;border:1px solid #444;border-radius:5px;text-align:center;}

#popup,#viewPopup{
position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:#111;padding:16px;border:2px solid #444;border-radius:12px;
width:90%;max-width:360px;max-height:90vh;overflow-y:auto;display:none;z-index:9999;
}
.popup-row{margin-bottom:8px;}
.popup-row label{font-size:12px;color:#bbb;}
.popup-row input,.popup-row textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #444;background:#1a1a1a;color:white;}
#popupButtons{display:flex;gap:8px;margin-top:10px;}
#popupButtons button{flex:1;padding:11px;border-radius:10px;background:#000;border:1px solid #444;color:white;font-weight:bold;}
</style>
</head>

<body>

<div id="topbar">
  <div id="counterWrapper">
    <div class="counter-box"><div class="counter-title">Artikel im Bestand</div><div id="countArtikel">0</div></div>
    <div class="counter-box"><div class="counter-title">Gegenst√§nde insgesamt</div><div id="countMenge">0</div></div>
    <div class="counter-box"><div class="counter-title">Warenwert aktuell (‚Ç¨)</div><div id="countWert">0</div></div>
    <div class="counter-box"><div class="counter-title">Warenwert gesamt (‚Ç¨)</div><div id="countWertTotal">0</div></div>
  </div>

  <div id="searchRow"><input id="search" placeholder="Suchen ‚Ä¶"></div>

  <div id="buttonRow">
    <button id="btnAdd">Artikel anlegen</button>
    <button id="btnExport">Sichern</button>
    <button id="btnImport">Laden</button>
    <button id="btnPDF">PDF</button>
  </div>
</div>

<div id="tableContainer">
<table>
<thead>
<tr>
  <th>*</th><th>Nr</th><th>Name</th><th>Menge</th>
  <th>Gr√∂√üe</th><th>Preis</th><th>Ort</th><th>Datum</th><th>Aktionen</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<div id="popup">
  <div class="popup-row"><label>Artikelnummer</label><input id="p_artnr"></div>
  <div class="popup-row"><label>Name</label><input id="p_name"></div>
  <div class="popup-row"><label>Menge</label><input type="number" id="p_menge" value="1"></div>
  <div class="popup-row"><label>Gr√∂√üe</label><input id="p_groesse"></div>
  <div class="popup-row"><label>Preis</label><input type="number" id="p_preis"></div>
  <div class="popup-row"><label>Ort</label><input id="p_ort"></div>
  <div class="popup-row"><label>Datum</label><input type="date" id="p_datum"></div>
  <div class="popup-row"><label>Bild</label><input type="file" id="p_bild"></div>
  <div class="popup-row"><label>Notiz</label><textarea id="p_notiz"></textarea></div>

  <div id="popupButtons">
    <button id="btnSave">Speichern</button>
    <button id="btnCancel">Abbrechen</button>
  </div>
</div>

<div id="viewPopup"></div>

<script>
let artikel = JSON.parse(localStorage.getItem("lagerData") || "[]");
let editIndex = -1;

/* ‚úÖ JAHRESWEISE FORTLAUFENDE ARTIKELNUMMER */
function getNextArtNr(){
  const year = new Date().getFullYear();
  const key = "artnrCounter_" + year;
  let counter = Number(localStorage.getItem(key) || 0) + 1;
  localStorage.setItem(key, counter);
  return String(counter).padStart(3, "0") + "-" + year;
}

/* TESTDATEN */
if(artikel.length===0){
artikel=[
{artnr:"001-2025",name:"Winterjacke",menge:2,groesse:"L",preis:59.99,ort:"Zara",datum:"2025-01-10",bild:"",notiz:"",markiert:false},
{artnr:"002-2025",name:"Sneaker",menge:1,groesse:"43",preis:89.90,ort:"Snipes",datum:"2025-02-03",bild:"",notiz:"",markiert:false}
];
localStorage.setItem("lagerData",JSON.stringify(artikel));
localStorage.setItem("artnrCounter_2025", 2);
}

function renderTable(){
tableBody.innerHTML="";
artikel.forEach((a,i)=>{
tableBody.insertAdjacentHTML("beforeend",`
<tr class="${a.markiert?"marked":""}">
<td onclick="toggleMark(${i})">${a.markiert?"‚≠ê":"‚òÜ"}</td>
<td>${a.artnr}</td>
<td>${a.name}</td>
<td><input class="miniQty" type="number" value="${a.menge}" oninput="updateQty(${i},this.value)"></td>
<td>${a.groesse}</td>
<td>${a.preis.toFixed(2)}</td>
<td>${a.ort}</td>
<td>${a.datum}</td>
<td class="iconCell">
<span onclick="viewImg(${i})">üì∑</span>
<span onclick="viewNote(${i})">üìù</span>
<span onclick="editArtikel(${i})">‚úèÔ∏è</span>
<span class="delete" onclick="del(${i})">üóë</span>
</td>
</tr>`);
});
updateCounters();
}

btnAdd.onclick=()=>{
editIndex=-1;
p_artnr.value = getNextArtNr();   // ‚úÖ AUTOMATISCHE NUMMER
p_name.value="";p_menge.value=1;p_groesse.value="";
p_preis.value="";p_ort.value="";p_datum.value="";
p_notiz.value="";p_bild.value="";
popup.style.display="block";
};

/* üîÅ RESTLICHER CODE BLEIBT UNVER√ÑNDERT (Speichern, Bearbeiten, L√∂schen, PDF, Suche, Export/Import)
   ‚Äî er ist technisch identisch zu deiner letzten funktionierenden Version ‚Äî */
</script>
</body>
</html>
