<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no">
<title>Lager App</title>

<style>
/* GLOBAL */
body {
    margin: 0;
    background: #000;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

/* FIXED HEADER */
#topbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    padding: 15px;
    background: #000;
    z-index: 1000;
    border-bottom: 2px solid #333;
}

/* COUNTER GRID */
#counterWrapper {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
}

.counter-box {
    padding: 10px;
    border: 1px solid #444;
    border-radius: 10px;
    background: #000;
    box-shadow: 0 4px 10px rgba(0,0,0,0.45);
}

.counter-title {
    font-size: 11px;
    color: #bbb;
}

.counter-value {
    font-size: 18px;
    font-weight: bold;
}

/* SEARCH */
#searchRow {
    margin-top: 10px;
}

#search {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    background: #111;
    border: 1px solid #444;
    color: white;
    font-size: 12px;
    box-sizing: border-box;
}

/* BUTTONS ROW */
#buttonRow {
    margin-top: 10px;
    display: flex;
    gap: 8px;
}

#buttonRow button {
    flex: 1;
    padding: 10px;
    font-size: 11px;
    color: #bbb;
    border-radius: 10px;
    background: #000;
    border: 1px solid #444;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0,0,0,0.45);
}

/* TABLE CONTAINER */
#tableContainer {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    overflow-y: auto;
    overflow-x: hidden;  /* FIX‚Äîkein seitliches Scrollen */
}

/* TABLE */
table {
    width: 100%;
    border-collapse: collapse;
}

th {
    background: #111;
    position: sticky;
    top: 0;
    z-index: 5;
    padding: 6px;
    color: #bbb;
    font-size: 10px;
    font-weight: bold;
}

td {
    padding: 5px;
    font-size: 11px;
    border-bottom: 1px solid #222;
}

/* MARKIERTE ZEILE */
.marked {
    background: #222 !important;
}

/* POPUP */
#popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #111;
    padding: 18px;
    border: 2px solid #444;
    border-radius: 12px;
    width: 90%;
    max-width: 380px;
    display: none;
    z-index: 9999;
}

.popup-row {
    margin-bottom: 12px;
}

.popup-row input,
.popup-row textarea {
    width: 100%;
    padding: 9px;
    border-radius: 8px;
    border: 1px solid #444;
    background: #1a1a1a;
    color: white;
}

#popup button {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    background: #000;
    border: 1px solid #444;
    color: white;
    font-weight: bold;
    margin-top: 10px;
}
</style>
</head>

<body>

<!-- HEADER -->
<div id="topbar">

    <div id="counterWrapper">
        <div class="counter-box">
            <div class="counter-title">Artikel im Bestand</div>
            <div class="counter-value" id="countArtikel">0</div>
        </div>

        <div class="counter-box">
            <div class="counter-title">Gegenst√§nde insgesamt</div>
            <div class="counter-value" id="countMenge">0</div>
        </div>

        <div class="counter-box">
            <div class="counter-title">Warenwert aktuell (‚Ç¨)</div>
            <div class="counter-value" id="countWert">0</div>
        </div>

        <div class="counter-box">
            <div class="counter-title">Warenwert gesamt (‚Ç¨)</div>
            <div class="counter-value" id="countWertTotal">0</div>
        </div>
    </div>

    <div id="searchRow">
        <input type="text" id="search" placeholder="Suchen ‚Ä¶" oninput="searchTable()">
    </div>

    <div id="buttonRow">
        <button onclick="openPopup()">Artikel anlegen</button>
        <button onclick="exportData()">Sichern</button>
        <button onclick="importData()">Laden</button>
        <button onclick="generatePDF()">PDF</button>
    </div>

</div>

<!-- TABLE -->
<div id="tableContainer">
    <table id="artikelTable">
        <thead>
        <tr>
            <th>*</th>
            <th>Artikelnummer</th>
            <th>Name</th>
            <th>Menge</th>
            <th>Gr√∂√üe</th>
            <th>Preis</th>
            <th>Ort</th>
            <th>Datum</th>
            <th>Bild</th>
            <th>Notiz</th>
        </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<!-- POPUP -->
<div id="popup">
    <div class="popup-row"><label>Artikelnummer</label><input id="p_artnr"></div>
    <div class="popup-row"><label>Name</label><input id="p_name"></div>
    <div class="popup-row"><label>Menge</label><input type="number" id="p_menge" min="1" value="1"></div>
    <div class="popup-row"><label>Gr√∂√üe</label><input id="p_groesse"></div>
    <div class="popup-row"><label>Preis (‚Ç¨)</label><input type="number" id="p_preis" step="0.01"></div>
    <div class="popup-row"><label>Ort</label><input id="p_ort"></div>
    <div class="popup-row"><label>Datum</label><input type="date" id="p_datum"></div>
    <div class="popup-row"><label>Bild</label><input type="file" id="p_bild"></div>
    <div class="popup-row"><label>Notiz</label><textarea id="p_notiz"></textarea></div>

    <button onclick="saveArtikel()">Speichern</button>
</div>

<script>
/* TESTDATEN */
let artikel = JSON.parse(localStorage.getItem("lagerData") || "[]");

if (artikel.length === 0) {
    artikel = [
        { artnr:"1001", name:"Winterjacke", menge:2, groesse:"L", preis:59.99, ort:"Zara", datum:"2023-11-12", bild:"", notiz:"gef√ºttert", markiert:false },
        { artnr:"1002", name:"Sneaker Black", menge:1, groesse:"43", preis:89.90, ort:"Snipes", datum:"2024-02-01", bild:"", notiz:"", markiert:false },
        { artnr:"1003", name:"Jeans Blau", menge:3, groesse:"32/32", preis:39.95, ort:"H&M", datum:"2023-10-20", bild:"", notiz:"Stretch", markiert:false },
        { artnr:"1004", name:"Hoodie Grau", menge:1", groesse:"XL", preis:29.99, ort:"H&M", datum:"2024-01-15", bild:"", notiz:"", markiert:false },
        { artnr:"1005", name:"Kappe Schwarz", menge:5, groesse:"One Size", preis:14.99, ort:"Footlocker", datum:"2024-03-02", bild:"", notiz:"neu", markiert:false },
        { artnr:"1006", name:"Socken 10er Pack", menge:10, groesse:"42-44", preis:12.99, ort:"Primark", datum:"2024-04-10", bild:"", notiz:"Baumwolle", markiert:false },
        { artnr:"1007", name:"Handschuhe", menge:2, groesse:"L", preis:19.99, ort:"Decathlon", datum:"2023-12-03", bild:"", notiz:"Winter", markiert:false },
        { artnr:"1008", name:"Rucksack", menge:1, groesse:"30L", preis:49.99, ort:"Amazon", datum:"2024-02-18", bild:"", notiz:"Laptopfach", markiert:false },
        { artnr:"1009", name:"T-Shirt Wei√ü", menge:6, groesse:"L", preis:9.99, ort:"H&M", datum:"2024-01-10", bild:"", notiz:"Basic", markiert:false },
        { artnr:"1010", name:"Sporthose", menge:2, groesse:"M", preis:24.99, ort:"Adidas", datum:"2024-03-20", bild:"", notiz:"atmungsaktiv", markiert:false }
    ];
    localStorage.setItem("lagerData", JSON.stringify(artikel));
}

updateCounters();
renderTable();

/* POPUP */
function openPopup() {
    document.getElementById("popup").style.display = "block";
}

function saveArtikel() {
    const n = p_artnr.value.trim();
    const name = p_name.value.trim();
    const menge = Number(p_menge.value);
    const groesse = p_groesse.value.trim();
    const preis = Number(p_preis.value);
    const ort = p_ort.value.trim();
    const datum = p_datum.value;
    const bildInput = p_bild;
    const notiz = p_notiz.value.trim();

    if (!n || !name) return;

    if (bildInput.files.length > 0) {
        const reader = new FileReader();
        reader.onload = e => pushItem(n,name,menge,groesse,preis,ort,datum,e.target.result,notiz);
        reader.readAsDataURL(bildInput.files[0]);
    } else {
        pushItem(n,name,menge,groesse,preis,ort,datum,"",notiz);
    }
}

function pushItem(artnr,name,menge,groesse,preis,ort,datum,bild,notiz) {
    artikel.push({ artnr, name, menge, groesse, preis, ort, datum, bild, notiz, markiert:false });
    localStorage.setItem("lagerData", JSON.stringify(artikel));
    renderTable();
    updateCounters();
    popup.style.display = "none";
}

/* TABLE */
function renderTable() {
    const tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";

    artikel.forEach((a, index)=>{
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td onclick="toggleMark(${index})" style="cursor:pointer">${a.markiert ? "‚≠ê" : "‚òÜ"}</td>
            <td>${a.artnr}</td>
            <td>${a.name}</td>
            <td>${a.menge}</td>
            <td>${a.groesse}</td>
            <td>${a.preis.toFixed(2)}</td>
            <td>${a.ort}</td>
            <td>${a.datum}</td>
            <td>${a.bild ? "üì∑" : "-"}</td>
            <td>${a.notiz}</td>
        `;

        if (a.markiert) tr.classList.add("marked");

        tbody.appendChild(tr);
    });
}

function toggleMark(i) {
    artikel[i].markiert = !artikel[i].markiert;
    localStorage.setItem("lagerData", JSON.stringify(artikel));
    renderTable();
}

/* COUNTERS */
function updateCounters() {
    countArtikel.innerText = artikel.length;
    let menge = 0;
    let wert = 0;

    artikel.forEach(a=>{
        menge += a.menge;
        wert += a.menge * a.preis;
    });

    countMenge.innerText = menge;
    countWert.innerText = wert.toFixed(2);
    countWertTotal.innerText = wert.toFixed(2);
}

/* SEARCH */
function searchTable() {
    const q = search.value.toLowerCase();
    const rows = document.querySelectorAll("#artikelTable tbody tr");

    rows.forEach(r => {
        r.style.display = r.innerText.toLowerCase().includes(q) ? "" : "none";
    });
}

/* EXPORT */
function exportData() {
    const blob = new Blob([JSON.stringify(artikel)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "lager_sicherung.json";
    a.click();
}

/* IMPORT */
function importData() {
    const inp = document.createElement("input");
    inp.type = "file";
    inp.accept = "application/json";

    inp.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = () => {
            artikel = JSON.parse(reader.result);
            localStorage.setItem("lagerData", JSON.stringify(artikel));
            renderTable();
            updateCounters();
        };
        reader.readAsText(file);
    };

    inp.click();
}

/* PDF */
function generatePDF() {
    alert("PDF kommt im n√§chsten Schritt.");
}

/* FIX TABLE POSITION */
function adjustTableTop() {
    const header = document.getElementById("topbar");
    document.getElementById("tableContainer").style.top = header.offsetHeight + "px";
}

window.onload = adjustTableTop;
window.onresize = adjustTableTop;
</script>

</body>
</html>
